{% macro backtest_params() %}
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">Backtest Parameters</h5>
    </div>
    <div class="card-body">
        <form id="backtest-form">
            <!-- Portfolio & Cost Parameters -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="initial_portfolio_size" class="form-label">Initial Portfolio Size ($)</label>
                        <input type="number" class="form-control" id="initial_portfolio_size" name="initial_portfolio_size" value="10000" min="1000" step="1000">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="commission" class="form-label">Commission per Trade ($)</label>
                        <input type="number" class="form-control" id="commission" name="commission" value="0.65" min="0" step="0.01">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="slippage" class="form-label">Slippage per Trade ($)</label>
                        <input type="number" class="form-control" id="slippage" name="slippage" value="0.1" min="0" step="0.01">
                    </div>
                </div>
            </div>

            <!-- Other Parameters -->
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="stop_loss_pct" class="form-label">Stop Loss (%)</label>
                        <input type="number" class="form-control" id="stop_loss_pct" name="stop_loss_pct" value="2" min="0.1" max="10" step="0.1">
                    </div>
                    <div class="mb-3">
                        <label for="take_profit_pct" class="form-label">Take Profit (%)</label>
                        <input type="number" class="form-control" id="take_profit_pct" name="take_profit_pct" value="4" min="0.1" max="20" step="0.1">
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="entry_delay" class="form-label">Entry Delay (candles)</label>
                        <input type="number" class="form-control" id="entry_delay" name="entry_delay" value="1" min="0" max="5">
                    </div>
                    <div class="mb-3">
                        <label for="max_holding_periods" class="form-label">Max Holding Period (candles)</label>
                        <input type="number" class="form-control" id="max_holding_periods" name="max_holding_periods" value="20" min="1" max="100">
                    </div>
                </div>
            </div>
            
            <div class="text-end mt-3">
                <button type="button" class="btn btn-primary" id="runBacktest">
                    <i class="bi bi-play-fill me-2"></i>Run Backtest
                </button>
            </div>
        </form>
    </div>
</div>

<div id="backtestResults" class="card mb-4 d-none">
    <div class="card-header">
        <h5 class="mb-0">Backtest Results</h5>
    </div>
    <div class="card-body">
        <!-- Performance Metrics -->
        <div class="row mb-4">
            <div class="col-md-6">
                <h6 class="mb-3">Performance Metrics</h6>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <tr>
                            <td>Total Trades:</td>
                            <td id="totalTrades">0</td>
                        </tr>
                        <tr>
                            <td>Winning Trades:</td>
                            <td id="winningTrades">0</td>
                        </tr>
                        <tr>
                            <td>Losing Trades:</td>
                            <td id="losingTrades">0</td>
                        </tr>
                        <tr>
                            <td>Win Rate:</td>
                            <td id="winRate">0%</td>
                        </tr>
                        <tr>
                            <td>Profit Factor:</td>
                            <td id="profitFactor">0.00</td>
                        </tr>
                        <tr>
                            <td>Average Profit per Trade:</td>
                            <td id="averageProfit">0%</td>
                        </tr>
                        <tr>
                            <td>Total Profit:</td>
                            <td id="totalProfit">0%</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <!-- Portfolio Summary -->
            <div class="col-md-6">
                <h6 class="mb-3">Portfolio Summary</h6>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <tr>
                            <td>Initial Portfolio Value:</td>
                            <td id="initialPortfolioValue">$0</td>
                        </tr>
                        <tr>
                            <td>Final Portfolio Value:</td>
                            <td id="finalPortfolioValue">$0</td>
                        </tr>
                        <tr>
                            <td>Total Commission Paid:</td>
                            <td id="totalCommission">$0</td>
                        </tr>
                        <tr>
                            <td>Total Slippage Cost:</td>
                            <td id="totalSlippage">$0</td>
                        </tr>
                    </table>
                </div>
                
                <!-- Portfolio Chart Button -->
                <div class="text-center mt-3">
                    <button type="button" class="btn btn-outline-primary" id="showPortfolioChart">
                        <i class="bi bi-graph-up me-2"></i>Show Portfolio Chart
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Portfolio Chart -->
        <div id="portfolioChartContainer" class="d-none">
            <canvas id="portfolioChart"></canvas>
        </div>
        
        <!-- Trades Table -->
        <h6 class="mb-3">Trade History</h6>
        <div class="table-responsive">
            <table class="table table-sm table-hover">
                <thead>
                    <tr>
                        <th>Entry Date</th>
                        <th>Exit Date</th>
                        <th>Entry Price</th>
                        <th>Exit Price</th>
                        <th>Profit %</th>
                        <th>Profit $</th>
                        <th>Periods Held</th>
                        <th>Exit Reason</th>
                    </tr>
                </thead>
                <tbody id="tradesTable">
                    <!-- Trades will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endmacro %} 